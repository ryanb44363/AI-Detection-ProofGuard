<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProofGuard ‚Äì Uploads</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=2" />
    <meta name="description" content="Recent uploads" />
    <style>
      :root { --bg:#f9fafb; --card:#ffffff; --border:#e5e7eb; --text:#111827; --muted:#6b7280; --blue:#2563eb; --green:#10b981; --amber:#f59e0b; }
      * { box-sizing:border-box; }
      body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--text); }
      .container { max-width: 1100px; margin: 0 auto; padding: 24px 20px; }
      .app-header{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 40px;border-bottom:1px solid #edf0f2;background:#fff;position:sticky;top:0;z-index:20}
      .brand{display:flex;align-items:center;gap:10px}
      .logo-img{width:34px;height:34px;border-radius:8px;display:block}
      .brand-name{font-size:20px;font-weight:700;color:#111827;text-decoration:none}
      .muted-2{color:#7f8790}
      .nav{display:flex;gap:18px;color:#3a424a}
      .nav-link{font-size:14px;font-weight:500;color:#3a424a;text-decoration:none}
      .nav-link:hover{color:#111827}
      .nav-link.active{color:#111827;text-decoration:underline;text-underline-offset:6px}
      .actions-inline{display:flex;gap:12px;align-items:center}
      .btn-link{background:transparent;border:none;font-weight:600;cursor:pointer;color:#2d3a45;text-decoration:none}
      .btn-link:hover{color:#111827}
      .btn-ghost{background:#fff;color:#2d3a45;border:1px solid #e0e4e8;border-radius:999px;padding:8px 18px;font-weight:700;text-decoration:none}
      .btn-ghost:hover{background:#f0f4f7}
  /* Ensure hidden works across overrides */
  [hidden]{display:none !important}
  /* Mobile nav */
  .mobile-toggle{display:none;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:6px 10px;font-weight:700}
  .mobile-menu{display:none;border-top:1px solid #edf0f2;background:#fff}
  .mobile-menu a{display:block;padding:10px 16px;color:#3a424a;text-decoration:none;border-bottom:1px solid #f1f5f9}
  .mobile-menu a:hover{background:#f8fafc;color:#111827}
  /* Show mobile toggle and hide desktop nav on small screens */
  @media (max-width: 720px){ .nav, .actions-inline { display:none } .mobile-toggle{display:block} .mobile-menu{display:block} }

      .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow: 0 6px 20px rgba(0,0,0,.04); }
      .title-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
      .title { font-size:20px; font-weight:800; }
      .muted { color:var(--muted); font-size: 12px; }
      .toolbar { display:flex; gap:10px; }
      .btn { padding:8px 12px; border-radius:10px; font-weight:600; border:1px solid var(--border); background:#fff; cursor:pointer; text-decoration:none; }
      .btn-danger { background:#fee2e2; border-color:#fecaca; color:#991b1b; }

  .rows { display:flex; flex-direction:column; gap:8px; }
  .row { display:grid; grid-template-columns: 48px 1fr 100px 90px 110px 90px; align-items:center; gap:12px; padding:10px; border:1px solid var(--border); border-radius:12px; background:#fff; }
      .thumb { width:48px; height:48px; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; background: #f3f4f6; border:1px solid var(--border); font-size:18px; }
      .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
  .name { font-size:14px; color:#111827; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; }
      .badge { display:inline-block; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px; }
      .badge-green { background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; text-transform:capitalize; text-align:center }
      .badge-amber { background:#fffbeb; color:#92400e; border:1px solid #fcd34d; text-transform:capitalize; text-align:center }
      .score { font-weight:800; text-align:right }
      .date { color:#374151; font-size:12px; text-align:right }

      .empty { text-align:center; padding:28px; color:#6b7280 }
      /* Global footer */
      .site-footer{background:#fff;border-top:1px solid #edf0f2;margin-top:24px}
      .foot-wrap{max-width:1100px;margin:0 auto;padding:20px}
      .foot-brand{display:flex;gap:12px;align-items:center;margin-bottom:12px}
      .foot-brand .logo-img{width:28px;height:28px}
      .fb-name{font-weight:800;font-size:16px}
      .fb-tag{font-size:12px;color:#6b7280}
      .foot-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:12px 0}
      .foot-title{font-size:12px;font-weight:800;color:#374151;text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
      .foot-link{display:block;color:#3a424a;font-size:13px;margin:4px 0;text-decoration:none}
      .foot-link:hover{color:#111827;text-decoration:underline}
      .foot-bar{display:flex;align-items:center;justify-content:space-between;padding-top:10px;border-top:1px solid #edf0f2;font-size:12px;color:#6b7280}
      @media (max-width:720px){.foot-grid{grid-template-columns:1fr 1fr}.foot-bar{flex-direction:column;align-items:flex-start;gap:8px}}
    @media (max-width: 820px){ .row{grid-template-columns:48px 1fr 100px 90px 90px;} .date{display:none} }
    @media (max-width: 560px){ .row{grid-template-columns:48px 1fr 70px 86px;} .row .status{display:none} }
    </style>
  </head>
  <body>
    <header class="app-header">
      <div class="brand">
        <img src="/favicon.svg?v=2" alt="ProofGuard logo" class="logo-img" />
        <a href="/" class="brand-name">Proof<span class="muted-2">Guard</span></a>
      </div>
      <nav class="nav">
        <a href="/" class="nav-link">Home</a>
        <a href="/uploads.html" class="nav-link active">Uploads</a>
        <a href="/api.html" class="nav-link">API</a>
        <a href="/plugins.html" class="nav-link">Plugins</a>
  <a href="/pricing.html" class="nav-link">Pricing</a>
  <a href="/docs.html" class="nav-link">Docs</a>
  <a href="/blog.html" class="nav-link">Blog</a>
      </nav>
      <div class="actions-inline">
        <a href="/signup.html" class="btn-link">Log in</a>
        <a href="/signup.html" class="btn-ghost">Sign up</a>
      </div>
      <button id="mobile-menu-button" class="mobile-toggle" aria-controls="mobile-menu" aria-expanded="false">Menu</button>
    </header>
    <nav id="mobile-menu" class="mobile-menu" hidden>
      <a href="/">Home</a>
      <a href="/uploads.html">Uploads</a>
      <a href="/api.html">API</a>
      <a href="/plugins.html">Plugins</a>
  <a href="/pricing.html">Pricing</a>
  <a href="/docs.html">Docs</a>
  <a href="/blog.html">Blog</a>
      <a href="/signup.html">Log in</a>
      <a href="/signup.html">Sign up</a>
    </nav>

    <div class="container">
      <div class="title-row">
        <div>
          <div class="title">Recent Uploads</div>
          <div class="muted">Stored locally in your browser ‚Ä¢ Last 15</div>
        </div>
        <div class="toolbar">
          <button class="btn btn-danger" id="clear-btn">Clear</button>
        </div>
      </div>

      <div class="card">
        <div id="rows" class="rows"></div>
        <div id="empty" class="empty" style="display:none">No uploads yet. Try analyzing a file from the home page.</div>
      </div>
    </div>

    <script>
      function escapeHtml(s){ return String(s||'').replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]||c)); }
      function fmtDate(ts){ try{ const d=new Date(ts); return d.toLocaleString(); }catch{ return ''} }

      // When clicking an upload entry, navigate to the unified result page using localStorage payload

      function render(){
        const rows = document.getElementById('rows');
        const empty = document.getElementById('empty');
        const raw = localStorage.getItem('pg_uploads');
        let arr = [];
        try { const parsed = JSON.parse(raw || '[]'); arr = Array.isArray(parsed) ? parsed : []; } catch { arr = []; }
        if (!arr.length) { rows.style.display='none'; empty.style.display='block'; return; }
        // Sort by newest first and limit to 15 entries
        arr.sort((a,b) => (Number(b.ts)||0) - (Number(a.ts)||0));
        arr = arr.slice(0, 15);
        rows.style.display='flex'; empty.style.display='none';

        function createRow(entry){
          const verdict = (entry.result && entry.result.verdict) || 'unknown';
          const details = (entry.result && entry.result.details) || {};
          const finalScore = (typeof details.final_score==='number') ? details.final_score : (entry.result && entry.result.score) || 0;
          const scorePct = Math.max(0, Math.min(100, Math.round(finalScore*100)));
          const badgeClass = verdict === 'authentic' ? 'badge-green' : 'badge-amber';

          const row = document.createElement('div');
          row.className = 'row';

          // thumb
          const thumb = document.createElement('div');
          thumb.className = 'thumb';
          if (entry.kind === 'image' && entry.thumbUrl) {
            const img = document.createElement('img');
            img.src = entry.thumbUrl;
            img.alt = 'thumb';
            thumb.appendChild(img);
          } else {
            thumb.textContent = entry.kind === 'pdf' ? 'üìÑ' : 'üìù';
            thumb.title = entry.kind === 'pdf' ? 'PDF' : 'Text';
          }
          row.appendChild(thumb);

          // name
          const name = document.createElement('div');
          name.className = 'name';
          name.title = entry.fileName || '';
          name.textContent = entry.fileName || '';
          row.appendChild(name);

          // status/badge
          const status = document.createElement('div');
          status.className = 'status';
          const badge = document.createElement('span');
          badge.className = 'badge ' + badgeClass;
          badge.textContent = verdict;
          status.appendChild(badge);
          row.appendChild(status);

          // score
          const score = document.createElement('div');
          score.className = 'score';
          score.textContent = String(scorePct) + '%';
          row.appendChild(score);

          // date
          const date = document.createElement('div');
          date.className = 'date';
          date.textContent = fmtDate(entry.ts);
          row.appendChild(date);

          // action
          const action = document.createElement('div');
          action.style.textAlign = 'right';
          const btn = document.createElement('button');
          btn.className = 'btn';
          btn.setAttribute('data-id', entry.id);
          btn.setAttribute('aria-label', 'View result for ' + (entry.fileName || 'upload'));
          btn.textContent = 'View';
          action.appendChild(btn);
          row.appendChild(action);

          return row;
        }

        const nodes = arr.map(createRow);
        rows.replaceChildren(...nodes);
      }

      document.getElementById('clear-btn').addEventListener('click', function(){
        if (confirm('Clear local uploads history?')) { localStorage.removeItem('pg_uploads'); location.reload(); }
      });

      // Delegated click handler for all row buttons (outside render to avoid duplicate bindings)
      document.getElementById('rows').addEventListener('click', function(e){
        var t = e.target;
        if (!t || !t.closest) return;
        var btn = t.closest('button[data-id]');
        if (!btn) return;
        var id = btn.getAttribute('data-id');
        var raw = localStorage.getItem('pg_uploads');
        var arr = [];
        try { var parsed = JSON.parse(raw || '[]'); arr = Array.isArray(parsed) ? parsed : []; } catch { arr = []; }
        var entry = arr.find(function(x){ return x.id === id });
        if (!entry) return;
        // Construct payload and navigate to result page via query id
        try {
          var payload = {
            fileName: entry.fileName,
            previewUrl: entry.previewUrl || null,
            isImage: entry.kind === 'image',
            isPdf: entry.kind === 'pdf',
            result: entry.result || null
          };
          var resId = String(Date.now()) + '-' + Math.random().toString(36).slice(2,8);
          try { localStorage.setItem('result:' + resId, JSON.stringify(payload)); } catch {}
          var url = new URL(window.location.origin + '/result.html');
          url.searchParams.set('id', resId);
          window.location.href = url.toString();
        } catch(_) {
          // As a last resort, fall back to home
          window.location.href = '/';
        }
      });

      render();

      // Mobile menu toggle (local safety net in case site.js isn't loaded on this page)
      (function(){
        var btn = document.getElementById('mobile-menu-button');
        var menu = document.getElementById('mobile-menu');
        if (!btn || !menu) return;
        function closeMenu(){ menu.setAttribute('hidden',''); btn.setAttribute('aria-expanded','false'); }
        function toggleMenu(){
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          if (expanded) { menu.setAttribute('hidden',''); } else { menu.removeAttribute('hidden'); }
        }
        btn.addEventListener('click', function(e){ e.stopPropagation(); toggleMenu(); });
        document.addEventListener('click', function(e){
          if (!menu.hasAttribute('hidden')) {
            var target = e.target;
            if (target && !menu.contains(target) && !btn.contains(target)) closeMenu();
          }
        });
        // Close on ESC for accessibility
        document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeMenu(); });
      })();
    </script>
    <footer class="site-footer">
      <div class="foot-wrap">
        <div class="foot-brand">
          <img src="/favicon.svg?v=2" alt="ProofGuard" class="logo-img"/>
          <div>
            <div class="fb-name">ProofGuard</div>
            <div class="fb-tag">Detect AI content ‚Äî fast and free.</div>
          </div>
        </div>
        <div class="foot-grid">
          <div>
            <div class="foot-title">Product</div>
            <a class="foot-link" href="/uploads.html">Uploads</a>
            <a class="foot-link" href="/pricing.html">Pricing</a>
          </div>
          <div>
            <div class="foot-title">Developers</div>
            <a class="foot-link" href="/api.html">API</a>
            <a class="foot-link" href="/plugins.html">Plugins</a>
            <a class="foot-link" href="/docs.html">Docs</a>
          </div>
          <div>
            <div class="foot-title">Company</div>
            <a class="foot-link" href="/docs.html#privacy">Privacy</a>
            <a class="foot-link" href="/docs.html#terms">Terms</a>
            <a class="foot-link" href="/signup.html">Sign up</a>
          </div>
        </div>
        <div class="foot-bar">
          <div>¬© <span id="yr-u"></span> ProofGuard</div>
          <div>Made for reliable AI-content checks</div>
        </div>
      </div>
    </footer>
    <script>document.getElementById('yr-u').textContent = String(new Date().getFullYear());</script>
    <script src="/site.js" defer></script>
  </body>
</html>