<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProofGuard ‚Äì Uploads</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=2" />
    <meta name="description" content="Recent uploads" />
    <style>
      :root { --bg:#f9fafb; --card:#ffffff; --border:#e5e7eb; --text:#111827; --muted:#6b7280; --blue:#2563eb; --green:#10b981; --amber:#f59e0b; }
      * { box-sizing:border-box; }
      body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--text); }
      .container { max-width: 1100px; margin: 0 auto; padding: 24px 20px; }
      .app-header{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 40px;border-bottom:1px solid #edf0f2;background:#fff;position:sticky;top:0;z-index:20}
      .brand{display:flex;align-items:center;gap:10px}
      .logo-img{width:34px;height:34px;border-radius:8px;display:block}
      .brand-name{font-size:20px;font-weight:700;color:#111827;text-decoration:none}
      .muted-2{color:#7f8790}
      .nav{display:flex;gap:18px;color:#3a424a}
      .nav-link{font-size:14px;font-weight:500;color:#3a424a;text-decoration:none}
      .nav-link:hover{color:#111827}
      .nav-link.active{color:#111827;text-decoration:underline;text-underline-offset:6px}
      .actions-inline{display:flex;gap:12px;align-items:center}
      .btn-link{background:transparent;border:none;font-weight:600;cursor:pointer;color:#2d3a45;text-decoration:none}
      .btn-link:hover{color:#111827}
      .btn-ghost{background:#fff;color:#2d3a45;border:1px solid #e0e4e8;border-radius:999px;padding:8px 18px;font-weight:700;text-decoration:none}
      .btn-ghost:hover{background:#f0f4f7}

      .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow: 0 6px 20px rgba(0,0,0,.04); }
      .title-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
      .title { font-size:20px; font-weight:800; }
      .muted { color:var(--muted); font-size: 12px; }
      .toolbar { display:flex; gap:10px; }
      .btn { padding:8px 12px; border-radius:10px; font-weight:600; border:1px solid var(--border); background:#fff; cursor:pointer; text-decoration:none; }
      .btn-danger { background:#fee2e2; border-color:#fecaca; color:#991b1b; }

  .rows { display:flex; flex-direction:column; gap:8px; }
  .row { display:grid; grid-template-columns: 48px 1fr 100px 90px 110px 90px; align-items:center; gap:12px; padding:10px; border:1px solid var(--border); border-radius:12px; background:#fff; }
      .thumb { width:48px; height:48px; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; background: #f3f4f6; border:1px solid var(--border); font-size:18px; }
      .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
      .name { font-size:14px; color:#111827; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
      .badge { display:inline-block; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px; }
      .badge-green { background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; text-transform:capitalize; text-align:center }
      .badge-amber { background:#fffbeb; color:#92400e; border:1px solid #fcd34d; text-transform:capitalize; text-align:center }
      .score { font-weight:800; text-align:right }
      .date { color:#374151; font-size:12px; text-align:right }

      .empty { text-align:center; padding:28px; color:#6b7280 }
      /* Global footer */
      .site-footer{background:#fff;border-top:1px solid #edf0f2;margin-top:24px}
      .foot-wrap{max-width:1100px;margin:0 auto;padding:20px}
      .foot-brand{display:flex;gap:12px;align-items:center;margin-bottom:12px}
      .foot-brand .logo-img{width:28px;height:28px}
      .fb-name{font-weight:800;font-size:16px}
      .fb-tag{font-size:12px;color:#6b7280}
      .foot-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:12px 0}
      .foot-title{font-size:12px;font-weight:800;color:#374151;text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
      .foot-link{display:block;color:#3a424a;font-size:13px;margin:4px 0;text-decoration:none}
      .foot-link:hover{color:#111827;text-decoration:underline}
      .foot-bar{display:flex;align-items:center;justify-content:space-between;padding-top:10px;border-top:1px solid #edf0f2;font-size:12px;color:#6b7280}
      @media (max-width:720px){.foot-grid{grid-template-columns:1fr 1fr}.foot-bar{flex-direction:column;align-items:flex-start;gap:8px}}
    </style>
  </head>
  <body>
    <header class="app-header">
      <div class="brand">
        <img src="/favicon.svg?v=2" alt="ProofGuard logo" class="logo-img" />
        <a href="/" class="brand-name">Proof<span class="muted-2">Guard</span></a>
      </div>
      <nav class="nav">
        <a href="/uploads.html" class="nav-link active">Uploads</a>
        <a href="/api.html" class="nav-link">API</a>
        <a href="/plugins.html" class="nav-link">Plugins</a>
        <a href="/pricing.html" class="nav-link">Pricing</a>
        <a href="/docs.html" class="nav-link">Docs</a>
      </nav>
      <div class="actions-inline">
        <a href="/signup.html" class="btn-link">Log in</a>
        <a href="/signup.html" class="btn-ghost">Sign up</a>
      </div>
    </header>

    <div class="container">
      <div class="title-row">
        <div>
          <div class="title">Recent Uploads</div>
          <div class="muted">Stored locally in your browser ‚Ä¢ Last 15</div>
        </div>
        <div class="toolbar">
          <button class="btn btn-danger" id="clear-btn">Clear</button>
        </div>
      </div>

      <div class="card">
        <div id="rows" class="rows"></div>
        <div id="empty" class="empty" style="display:none">No uploads yet. Try analyzing a file from the home page.</div>
      </div>
    </div>

    <script>
      function escapeHtml(s){ return String(s||'').replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]||c)); }
      function fmtDate(ts){ try{ const d=new Date(ts); return d.toLocaleString(); }catch{ return ''} }

      // Reuse a simplified version of the result page generator from UploadForm
      function buildResultHtmlFromEntry(entry){
        try{
          const payload = { fileName: entry.fileName, previewUrl: entry.previewUrl, isImage: entry.kind==='image', isPdf: entry.kind==='pdf', result: entry.result };
          // Minimal buildResultHtml port that delegates to window.opener UploadForm style would be complex; inline simplified version
          var result = payload.result || {};
          var verdict = result.verdict;
          var details = (result.details || {});
          var finalScore = (typeof details.final_score === 'number') ? details.final_score : (result.score || 0);
          var scorePct = Math.max(0, Math.min(100, Math.round(finalScore*100)));
          var color = verdict === 'authentic' ? '#10b981' : '#f59e0b';
          var reason = result.reason || '';
          var origin = window.location.origin;

          // Compose very similar page as UploadForm-generated one by leveraging a light template
          return `<!doctype html>
          <html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
          <base href="${origin}/" />
          <link rel="icon" type="image/svg+xml" href="${origin}/favicon.svg?v=2" /><title>ProofGuard ‚Äì Result</title>
          <style>:root{--bg:#f9fafb;--card:#fff;--border:#e5e7eb;--text:#111827;--muted:#6b7280;--blue:#2563eb}.container{max-width:1100px;margin:0 auto;padding:32px 20px 16px 20px}body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}.grid{display:grid;grid-template-columns:1fr;gap:24px}@media (min-width:900px){.grid{grid-template-columns:1fr 1fr}}.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 6px 20px rgba(0,0,0,.04)}.preview-box{position:relative;width:100%;padding-top:100%;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:linear-gradient(135deg,#eef2ff,#f5f3ff);display:block}.preview-box img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}.preview-pdf{position:relative;width:100%;height:520px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#fff}.preview-text{position:relative;width:100%;height:520px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#fff}.preview-pdf iframe,.preview-text iframe{position:absolute;inset:0;width:100%;height:100%;border:0}.filename{margin-top:10px;font-size:14px;color:#374151;word-break:break-all;display:flex;gap:8px;align-items:center}.gauge-wrap{width:100%;max-width:420px;margin:0 auto 12px auto}.center{text-align:center}.title-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;justify-content:center}.title{font-size:22px;font-weight:800}.muted{color:#6b7280;font-size:12px}/* Header (unified) */.app-header{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 40px;border-bottom:1px solid #edf0f2;background:#fff;position:sticky;top:0;z-index:20}.brand{display:flex;align-items:center;gap:10px}.logo-img{width:34px;height:34px;border-radius:8px;display:block}.brand-name{font-size:20px;font-weight:700;color:#111827;text-decoration:none}.muted-2{color:#7f8790}.nav{display:flex;gap:18px;color:#3a424a}.nav-link{font-size:14px;font-weight:500;color:#3a424a;text-decoration:none}.nav-link:hover{color:#111827}.actions-inline{display:flex;gap:12px;align-items:center}.btn-link{background:transparent;border:none;font-weight:600;cursor:pointer;color:#2d3a45;text-decoration:none}.btn-link:hover{color:#111827}.btn-ghost{background:#fff;color:#2d3a45;border:1px solid #e0e4e8;border-radius:999px;padding:8px 18px;font-weight:700;text-decoration:none}.btn-ghost:hover{background:#f0f4f7}.actions{margin-top:16px;display:grid;grid-template-columns:1fr 1fr;gap:10px}.btn{padding:10px 14px;border-radius:12px;font-weight:600;border:1px solid var(--border);background:#fff;cursor:pointer;text-decoration:none;text-align:center}.btn-primary{background:linear-gradient(90deg,var(--blue),#4f46e5);color:#fff;border:none}</style>
          </head><body>
          <header class="app-header"><div class="brand"><img src="${origin}/favicon.svg?v=2" alt="ProofGuard logo" class="logo-img"/><a href="${origin}/" class="brand-name">Proof<span class="muted-2">Guard</span></a></div><nav class="nav"><a href="${origin}/uploads.html" class="nav-link">Uploads</a><a href="${origin}/api.html" class="nav-link">API</a><a href="${origin}/plugins.html" class="nav-link">Plugins</a><a href="${origin}/pricing.html" class="nav-link">Pricing</a><a href="${origin}/docs.html" class="nav-link">Docs</a></nav><div class="actions-inline"><a href="${origin}/signup.html" class="btn-link">Log in</a><a href="${origin}/signup.html" class="btn-ghost">Sign up</a></div></header>
          <div class="container"><div class="grid"><div class="card">${(() => {
            const fn = escapeHtml(payload.fileName);
            const p = payload.previewUrl;
            if (!p) return `<div class='preview-box' style='display:flex;align-items:center;justify-content:center'><div class='muted'>No preview available</div></div><div class='filename'>üìé <span>${fn}</span></div>`;
            if (payload.isPdf) return `<div class='preview-pdf'><iframe src='${p}'></iframe></div><div class='filename'>üìÑ <span>${fn}</span></div>`;
            if (String(p).startsWith('data:text')) return `<div class='preview-text'><iframe src='${p}'></iframe></div><div class='filename'>üìù <span>${fn}</span></div>`;
            if (payload.isImage) return `<div class='preview-box'><img src='${p}'/></div><div class='filename'>üñºÔ∏è <span>${fn}</span></div>`;
            return `<div class='preview-box' style='display:flex;align-items:center;justify-content:center'><div class='muted'>No preview available</div></div><div class='filename'>üìé <span>${fn}</span></div>`;
          })()}</div>
          <div class="card"><div class="gauge-wrap"><div class="center"><svg viewBox="0 0 200 120" style="width:100%"><path d="M10 110 A90 90 0 0 1 190 110" fill="none" stroke="#e5e7eb" stroke-width="16" pathLength="100"/><path d="M10 110 A90 90 0 0 1 190 110" fill="none" stroke="${color}" stroke-linecap="round" stroke-width="16" pathLength="100" stroke-dasharray="${scorePct} 100"/></svg><div style="margin-top:-16px"><div style="font-size:32px;font-weight:800;color:${color}">${scorePct}%</div><div class="muted">Confidence</div></div></div></div><div class="title-row"><div class="title">${verdict==='authentic'?'Authentic Content':'Potentially AI-Generated'}</div></div><p style="color:#374151;font-size:14px;line-height:1.5">${escapeHtml(reason)}</p><div class="actions"><a class="btn" href="${origin}/" onclick="window.close();return true;">Back</a><a class="btn btn-primary" href="${origin}/">Analyze Another File</a></div>
          <hr style="margin:14px 0; border:none; border-top:1px solid #e5e7eb" />
          <div>
            <div style="font-weight:700;margin-bottom:8px;">Aspects and contributions</div>
            ${(() => {
              const sb = (payload.result && payload.result.details && payload.result.details.score_breakdown) || {};
              const isImg = payload.isImage;
              const isPdf = payload.isPdf;
              const aspectsBase = [{key:'base',label:'Base score',weight:0.45}];
              const aspectsImg = [
                {key:'metadata_hits',label:'Metadata indicators',weight:0.35},
                {key:'ocr_hits',label:'OCR AI terms',weight:0.25},
                {key:'low_entropy',label:'Low entropy',weight:0.05},
                {key:'low_edge_density',label:'Low edge density',weight:0.04},
                {key:'low_ela_mean',label:'Low ELA mean',weight:0.03},
                {key:'low_color_uniqueness',label:'Low color uniqueness',weight:0.04},
                {key:'missing_exif',label:'Missing EXIF',weight:0.04},
                {key:'low_laplacian',label:'Low Laplacian variance',weight:0.02},
                {key:'flat_blocks',label:'Flat-block ratio',weight:0.03},
                {key:'very_smooth_low_blockiness',label:'Very smooth, low blockiness',weight:0.01},
              ];
              const aspectsText = [
                {key:'ocr_hits',label:'Keyword/AI term hits',weight:0.25},
                {key:'high_repetition_low_ttr',label:'High repetition, low TTR',weight:0.06},
                {key:'avg_sentence_len_mid',label:'Average sentence length (mid)',weight:0.01},
                {key:'keyword_hits',label:'Keyword hits',weight:0.25},
              ];
              const pick = isImg ? aspectsImg : (isPdf ? aspectsText : aspectsText);
              const aspects = aspectsBase.concat(pick);
              const rows = aspects.map(a => {
                const val = typeof sb[a.key] === 'number' ? sb[a.key] : 0;
                const pct = Math.round(val*100);
                if (pct === 0) return '';
                const max = Math.round((a.weight||0)*100);
                return `<div style="display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;margin:6px 0;">
                  <div style="font-size:13px;color:#374151">${a.label}</div>
                  <div style="font-weight:700">${pct}% <span class="muted" style="font-weight:500">/ ${max}%</span></div>
                </div>`;
              }).filter(Boolean);
              if (!rows.length) {
                return `<div class="muted" style="font-size:13px">No contributing aspects detected</div>`;
              }
              return rows.join('');
            })()}
          </div>
          <hr style="margin:14px 0; border:none; border-top:1px solid #e5e7eb" />
          <div>
            <div style="font-weight:700;margin-bottom:8px;">Rating breakdown</div>
            ${(() => {
              const details = (payload.result && payload.result.details) || {};
              const sb = details.score_breakdown || {};
              const entries = Object.keys(sb).filter(k => typeof sb[k] === 'number').map(k => ({ key:k, val: sb[k] }))
                .filter(x => x.val > 0);
              if (!entries.length) {
                return `<div style="display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;margin:6px 0;">
                  <div style="font-size:13px;color:#374151">Overall</div>
                  <div style="font-weight:700">${scorePct}%</div>
                </div>`;
              }
              const labelMap = {
                base:'Base score', metadata_hits:'Metadata indicators', ocr_hits:'OCR AI terms', low_entropy:'Low entropy', low_edge_density:'Low edge density',
                low_ela_mean:'Low ELA mean', low_color_uniqueness:'Low color uniqueness', missing_exif:'Missing EXIF', low_laplacian:'Low Laplacian variance',
                flat_blocks:'Flat-block ratio', very_smooth_low_blockiness:'Very smooth, low blockiness', high_repetition_low_ttr:'High repetition, low TTR',
                avg_sentence_len_mid:'Average sentence length (mid)', keyword_hits:'Keyword hits'
              };
              entries.sort((a,b) => b.val - a.val);
              const rows = entries.map(e => {
                const pct = Math.round(e.val * 100);
                return `<div style="display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;margin:6px 0;">
                  <div style="font-size:13px;color:#374151">${labelMap[e.key] || e.key}</div>
                  <div style="font-weight:700">${pct}%</div>
                </div>`;
              });
              const sum = entries.reduce((acc, e) => acc + (e.val || 0), 0);
              const residual = finalScore - sum;
              if (residual > 0.005) {
                rows.push(`<div style="display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;margin:6px 0;">
                  <div style="font-size:13px;color:#374151">Additional signals</div>
                  <div style="font-weight:700">${Math.round(residual*100)}%</div>
                </div>`);
              }
              return rows.join('');
            })()}
          </div>
          </div></div></div></body></html>`;
        } catch(e){ return '<!doctype html><title>Error</title><p>Could not render result.</p>'; }
      }

      function render(){
        const rows = document.getElementById('rows');
        const empty = document.getElementById('empty');
        const raw = localStorage.getItem('pg_uploads');
        let arr = [];
        try { const parsed = JSON.parse(raw || '[]'); arr = Array.isArray(parsed) ? parsed : []; } catch { arr = []; }
  if (!arr.length) { rows.style.display='none'; empty.style.display='block'; return; }
  // Sort by newest first and limit to 15 entries
  arr.sort((a,b) => (Number(b.ts)||0) - (Number(a.ts)||0));
  arr = arr.slice(0, 15);
  rows.style.display='flex'; empty.style.display='none';
  rows.innerHTML = '';
  arr.forEach(entry => {
          const verdict = (entry.result && entry.result.verdict) || 'unknown';
          const details = (entry.result && entry.result.details) || {};
          const finalScore = (typeof details.final_score==='number') ? details.final_score : (entry.result && entry.result.score) || 0;
          const scorePct = Math.max(0, Math.min(100, Math.round(finalScore*100)));
          const badgeClass = verdict === 'authentic' ? 'badge-green' : 'badge-amber';
          const div = document.createElement('div');
          div.className = 'row';
          const thumb = (() => {
            if (entry.kind === 'image' && entry.thumbUrl) return `<div class="thumb"><img src="${entry.thumbUrl}" alt="thumb"/></div>`;
            if (entry.kind === 'pdf') return `<div class="thumb" title="PDF">üìÑ</div>`;
            return `<div class="thumb" title="Text">üìù</div>`;
          })();
          div.innerHTML = `
            ${thumb}
            <div class="name" title="${escapeHtml(entry.fileName)}">${escapeHtml(entry.fileName)}</div>
            <div><span class="badge ${badgeClass}">${escapeHtml(verdict)}</span></div>
            <div class="score">${scorePct}%</div>
            <div class="date">${fmtDate(entry.ts)}</div>
            <div style="text-align:right"><button class="btn" data-id="${entry.id}">View</button></div>
          `;
          rows.appendChild(div);
        });

        rows.addEventListener('click', function(e){
          const t = e.target;
          if (t && t.tagName === 'BUTTON' && t.getAttribute('data-id')){
            const id = t.getAttribute('data-id');
            const raw = localStorage.getItem('pg_uploads');
            let arr = [];
            try { const parsed = JSON.parse(raw || '[]'); arr = Array.isArray(parsed) ? parsed : []; } catch { arr = []; }
            const entry = arr.find(x => x.id === id);
            if (!entry) return;
            const html = buildResultHtmlFromEntry(entry);
            const blobUrl = URL.createObjectURL(new Blob([html], { type: 'text/html' }));
            // Open in the same tab rather than a new one
            window.location.href = blobUrl;
          }
        });
      }

      document.getElementById('clear-btn').addEventListener('click', function(){
        if (confirm('Clear local uploads history?')) { localStorage.removeItem('pg_uploads'); location.reload(); }
      });

      render();
    </script>
    <footer class="site-footer">
      <div class="foot-wrap">
        <div class="foot-brand">
          <img src="/favicon.svg?v=2" alt="ProofGuard" class="logo-img"/>
          <div>
            <div class="fb-name">ProofGuard</div>
            <div class="fb-tag">Detect AI content ‚Äî fast and free.</div>
          </div>
        </div>
        <div class="foot-grid">
          <div>
            <div class="foot-title">Product</div>
            <a class="foot-link" href="/">Home</a>
            <a class="foot-link" href="/uploads.html">Uploads</a>
            <a class="foot-link" href="/pricing.html">Pricing</a>
          </div>
          <div>
            <div class="foot-title">Developers</div>
            <a class="foot-link" href="/api.html">API</a>
            <a class="foot-link" href="/plugins.html">Plugins</a>
            <a class="foot-link" href="/docs.html">Docs</a>
          </div>
          <div>
            <div class="foot-title">Company</div>
            <a class="foot-link" href="/docs.html#privacy">Privacy</a>
            <a class="foot-link" href="/docs.html#terms">Terms</a>
            <a class="foot-link" href="/signup.html">Sign up</a>
          </div>
        </div>
        <div class="foot-bar">
          <div>¬© <span id="yr-u"></span> ProofGuard</div>
          <div>Made for reliable AI-content checks</div>
        </div>
      </div>
    </footer>
    <script>document.getElementById('yr-u').textContent = String(new Date().getFullYear());</script>
  </body>
</html>
